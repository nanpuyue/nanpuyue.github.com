<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>在OpenWrt上搭建PXE服务器通过网络启动安装Debian | 南浦月</title>
  <meta name="author" content="南浦月">

  
  <meta name="description" content="前提：拥有一个带USB接口的并且已刷OpenWrt的路由器，路由器可以联网。  
将U盘挂载到路由器上，这个不在本文讨论范围之类，故假设U盘已经挂在到/mnt/sda1。通过SSH登录路由器，在/mnt/sda1下新建一个文件夹名曰pxe：  
mkdir -p /mnt/sda1/pxe
下载Debian的网络启动相关文件，文件可以在Debian的ftp上找到:ftp://ftp.debian.org/debian/dists/squeeze/main/installer-i386/current/images/netboot/ftp://ftp.debian.org/debian/dists/wheezy/main/installer-i386/current/images/netboot/  
上面分别是两个版本的启动文件，其子目录gtk下也是一套独立的启动文件，是有图形安装界面的。下载要下载整个目录，不需要图形界面的gtk这个目录可以不要，要图形界面的可以只下载gtk这个目录。最好是在Linux下使用wget进行递归下载，因为ftp中有些文件和目录是以链接的形式存在的，在Windows下下载可能造成链接丢失从而导致文件不全。比如：  
wget --cut-dirs=9 -nH -P wheezy-netboot-gtk -r ftp://ftp.debian.org/debian/dists/wheezy/main/installer-i386/current/images/netboot/gtk/">
  
  

  <link rel="alternate" href="/atom.xml" title="南浦月" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-35959106-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

</head>

<body>
  <header id="header" class="inner"><nav>
  <ul>
    
      <li><a href="/">首页</a></li>
    
      <li><a href="/archives">归档</a></li>
    
      <li><a href="/links">链接</a></li>
    
      <li><a href="/live">直播</a></li>
    
      <li><a href="/about">关于</a></li>
    
  </ul>
</nav></header>
  <div id="content" class="inner"><article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <header>
    
  
    <h1 class="title">在OpenWrt上搭建PXE服务器通过网络启动安装Debian</h1>
  

    <time datetime="2012-10-15T04:00:00.000Z">
  <span class="day">15</span><span class="month">10月</span>
</time>
  </header>
  <div class="entry-content">
    
      <p>前提：拥有一个带USB接口的并且已刷OpenWrt的路由器，路由器可以联网。  </p>
<p>将U盘挂载到路由器上，这个不在本文讨论范围之类，故假设U盘已经挂在到/mnt/sda1。<br>通过SSH登录路由器，在/mnt/sda1下新建一个文件夹名曰pxe：  </p>
<pre><code><span class="keyword">mkdir</span> -p /mnt/sda1/pxe
</code></pre><p>下载Debian的网络启动相关文件，文件可以在Debian的ftp上找到:<br><a href="ftp://ftp.debian.org/debian/dists/squeeze/main/installer-i386/current/images/netboot/">ftp://ftp.debian.org/debian/dists/squeeze/main/installer-i386/current/images/netboot/</a><br><a href="ftp://ftp.debian.org/debian/dists/wheezy/main/installer-i386/current/images/netboot/">ftp://ftp.debian.org/debian/dists/wheezy/main/installer-i386/current/images/netboot/</a>  </p>
<p>上面分别是两个版本的启动文件，其子目录gtk下也是一套独立的启动文件，是有图形安装界面的。<br>下载要下载整个目录，不需要图形界面的gtk这个目录可以不要，要图形界面的可以只下载gtk这个目录。<br>最好是在Linux下使用wget进行递归下载，因为ftp中有些文件和目录是以链接的形式存在的，在Windows下下载可能造成链接丢失从而导致文件不全。<br>比如：  </p>
<pre><code>wget <span class="subst">--</span>cut<span class="attribute">-dirs</span><span class="subst">=</span><span class="number">9</span> <span class="attribute">-nH</span> <span class="attribute">-P</span> wheezy<span class="attribute">-netboot</span><span class="attribute">-gtk</span> <span class="attribute">-r</span> ftp:<span class="comment">//ftp.debian.org/debian/dists/wheezy/main/installer-i386/current/images/netboot/gtk/</span>
</code></pre><p><a id="more"></a>或者：  </p>
<pre><code>wget <span class="subst">--</span>cut<span class="attribute">-dirs</span><span class="subst">=</span><span class="number">9</span> <span class="attribute">-nH</span> <span class="attribute">-P</span> squeeze<span class="attribute">-netboot</span><span class="attribute">-gtk</span> <span class="attribute">-r</span> ftp:<span class="comment">//ftp.debian.org/debian/dists/squeeze/main/installer-i386/current/images/netboot/gtk/</span>
</code></pre><p>如果下载很慢，可以换用国内镜像：  </p>
<pre><code>wget <span class="subst">--</span>cut<span class="attribute">-dirs</span><span class="subst">=</span><span class="number">9</span> <span class="attribute">-nH</span> <span class="attribute">-P</span> wheezy<span class="attribute">-netboot</span><span class="attribute">-gtk</span> <span class="attribute">-r</span> ftp:<span class="comment">//mirrors.ustc.edu.cn/debian/dists/wheezy/main/installer-i386/current/images/netboot/gtk/</span>
</code></pre><p>或者：  </p>
<pre><code>wget <span class="subst">--</span>cut<span class="attribute">-dirs</span><span class="subst">=</span><span class="number">9</span> <span class="attribute">-nH</span> <span class="attribute">-P</span> squeeze<span class="attribute">-netboot</span><span class="attribute">-gtk</span> <span class="attribute">-r</span> ftp:<span class="comment">//mirrors.ustc.edu.cn/debian/dists/squeeze/main/installer-i386/current/images/netboot/gtk/</span>
</code></pre><p>如果你要在OpenWrt上直接下载，需要安装wget以替代busybox内建的wget：  </p>
<pre><code>opkg <span class="operator"><span class="keyword">update</span>
opkg install wget</span>
</code></pre><p>这里是上面的命令所下载的文件打包：<br><a href="http://s.yunio.com/Y_7Zhu" target="_blank">wheezy-netboot-gtk_i386.tar.gz</a><br><a href="http://s.yunio.com/Lpmiqy" target="_blank">squeeze-netboot-gtk_i386.tar.gz</a>  </p>
<p>将所下载的文件放置到/mnt/sda1/pxe下，其目录下有类似以下一些文件和文件夹：  </p>
<p><img src="//img.nanpuyue.com/upload/2012/10/27/20121027153306-a819054e.png" alt="文件">  </p>
<p>如果你选择下载我提供的打包文件，可以将wheezy-netboot-gtk_i386.tar.gz上传到路由器/mnt/sda1/pxe，然后解压：  </p>
<pre><code>cd /mnt/sda1/pxe
tar <span class="attribute">-xzvf</span> wheezy<span class="attribute">-netboot</span><span class="attribute">-gtk_i386</span><span class="built_in">.</span>tar<span class="built_in">.</span>gz
</code></pre><p>然后wheezy-netboot-gtk_i386.tar.gz可以删除：  </p>
<pre><code>rm wheezy-netboot-gtk_i386<span class="preprocessor">.tar</span><span class="preprocessor">.gz</span>
</code></pre><p>进入OpenWrt的WEB设置界面，在“网络”-“DNS/DHCP”设置(即Dnsmasq设置)下，选择“TFTP设置”，做如下设置：<br>TFTP服务器根目录    /mnt/sda1/pxe/<br>网络启动镜像        pxelinux.0  </p>
<p><img src="//img.nanpuyue.com/upload/2012/10/27/20121027153310-9ba8094a.png" alt="设置">  </p>
<p>然后点击下方的“保存&amp;应用”。<br>这样，整个搭建过程就完成了，剩下的，只需要将电脑或者服务器接到路由器LAN口，并选择从网络启动即可。</p>

    
    
    <footer class="meta">
      
  <div class="cats">
<a href="/categories/Linux/">Linux</a><a href="/categories/Linux/OpenWrt/">OpenWrt</a></div>

      
  <div class="tags">
<a href="/tags/Linux/">Linux</a><a href="/tags/OpenWrt/">OpenWrt</a><a href="/tags/PXE/">PXE</a></div>

      
    </footer>
    
  </div>
  
<section id="comment">
  <div id="disqus_thread" aria-live="polite">
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</article>
</div>
  <footer id="footer" class="inner"><div class="social alignright">
  
    <a class="facebook" href="https://www.facebook.com/nanpuyue" title="Facebook">Facebook</a>
  
  
    <a class="google" href="https://plus.google.com/+nanpuyue" title="Google+">Google+</a>
  
  
    <a class="twitter" href="https://twitter.com/nanpuyue" title="Twitter">Twitter</a>
  
  
    <a class="github" href="https://github.com/nanpuyue" title="GitHub">GitHub</a>
  
  <a class="rss" href="/atom.xml" title="RSS">RSS</a>
</div>

<div align="left">
  
  &copy; 2012-2014 <a href="http://blog.nanpuyue.com"> 南浦月 </a>
  
</div>

<div class="clearfix"></div>
</footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
var disqus_shortname = 'nanpuyue';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<div id="phasebeam">
  <canvas></canvas>
  <canvas></canvas>
  <canvas></canvas>
</div>
<script src="/js/phasebeam.js"></script>
</body>
</html>